<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>文章详情 - TB Shop</title>
    <link href="/assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="/assets/css/all.min.css" rel="stylesheet">
    <link href="/themes/TBshop/files/custom-theme.css" rel="stylesheet">
    
    <script src="/themes/TBshop/files/common.js" defer></script>
</head>
<body>

    <header class="mobile-header d-lg-none" id="global-mobile-header"></header>
    <div class="mobile-sidebar d-lg-none" id="mobile-sidebar"></div>
    <div class="mobile-overlay d-lg-none" id="mobile-overlay" onclick="togglePanel('mobile-sidebar', 'mobile-overlay')"></div>
    <header class="tb-header d-none d-lg-block" id="global-pc-header"></header>

    <div class="container mt-4 mb-5">
        <div class="row gx-3">
            <div class="col-lg-9">
                
                <div class="module-box p-0 overflow-hidden" style="min-height: 600px;">
                    <div class="p-4 border-bottom bg-light bg-opacity-10">
                        <h3 class="fw-bold mb-3 mt-1 text-center" id="article-title">加载中...</h3>
                        <div class="text-center text-muted small d-flex justify-content-center align-items-center flex-wrap">
                            <span class="me-3"><i class="fa fa-calendar-alt me-1"></i> <span id="article-time">--</span></span>
                            <span class="me-3"><i class="fa fa-folder me-1"></i> <span id="article-cat">--</span></span>
                            <span><i class="fa fa-eye me-1"></i> <span id="article-views">--</span></span>
                        </div>
                    </div>
                    
                    <div class="p-4 p-md-5" style="font-size: 15px; line-height: 1.8; color: #333;">
                        <div id="article-content">
                            <div class="text-center py-5"><i class="fa fa-spinner fa-spin"></i></div>
                        </div>
                    </div>
                    
                    <div class="p-3 border-top text-center">
                        <a href="/articles.html" class="btn btn-outline-secondary btn-sm rounded-pill px-4">
                            <i class="fa fa-angle-left me-1"></i> 返回文章列表
                        </a>
                    </div>
                </div>

            </div>

            <div class="col-lg-3 d-none d-lg-block">
                <div id="sidebar-wrapper"> 
                    <div id="global-sidebar-right"></div>
                </div> 
            </div>
        </div>
    </div>

    <footer class="site-footer" id="global-footer"></footer>
    <nav class="mobile-bottom-nav d-lg-none" id="global-mobile-nav"></nav>

    <div class="mobile-contact-overlay d-lg-none" id="mobile-contact-overlay"></div>
    <div class="mobile-contact-sheet d-lg-none" id="mobile-contact-sheet">
        <div class="mcs-header">
            <span class="mcs-title">联系客服</span>
            <i class="fa fa-times mcs-close" id="mobile-contact-close-btn" onclick="togglePanel('mobile-contact-sheet', 'mobile-contact-overlay')"></i>
        </div>
        <div class="mcs-content" id="mobile-contact-content"><p>加载中...</p></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-sidebar/3.3.1/sticky-sidebar.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            if (typeof renderCommonLayout === 'function') {
                renderCommonLayout('article_detail');
            }
            // 加载侧边栏推荐
            if (typeof renderSidebarTopSales === 'function') {
                fetch('/api/shop/products').then(r=>r.json()).then(data => renderSidebarTopSales(data));
            }
            loadArticle();
        });

        async function loadArticle() {
            const id = new URLSearchParams(window.location.search).get('id');
            if (!id) {
                document.getElementById('article-title').innerText = '参数错误';
                return;
            }
            try {
                const res = await fetch(`/api/shop/article/get?id=${id}`);
                const data = await res.json();

                if (data.error) {
                     document.getElementById('article-title').innerText = '文章不存在';
                     document.getElementById('article-content').innerHTML = `<div class="text-center py-5 text-muted">${data.error}</div>`;
                     return;
                }

                document.title = data.title + ' - TB Shop';
                document.getElementById('article-title').innerText = data.title;
                document.getElementById('article-time').innerText = new Date(data.created_at * 1000).toLocaleDateString();
                document.getElementById('article-cat').innerText = data.category_name || '默认';
                document.getElementById('article-views').innerText = data.view_count;
                document.getElementById('article-content').innerHTML = data.content;
                
                // 图片自适应
                document.querySelectorAll('#article-content img').forEach(img => {
                    img.classList.add('img-fluid');
                    img.style.height = 'auto';
                });

            } catch (e) {
                document.getElementById('article-title').innerText = '加载失败';
            }
        }
    </script>
</body>
</html>
